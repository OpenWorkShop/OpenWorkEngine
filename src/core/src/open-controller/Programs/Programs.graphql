fragment MachineMovement on MachineMovement {
    x y z a b c u v w
    i j k
    dwell
}

fragment InstructionStep on InstructionStep {
    name
    settingValue
    movement {
        ...MachineMovement
    }
}

fragment ProgramInstruction on ProgramInstruction {
    steps {
        ...InstructionStep
    }
}

fragment ProgramFileRevision on ProgramFileRevision {
    id
    username
    createdAt
    # checksum
}

fragment ProgramFileMetaData on ProgramFileMetaData {
    tags
    revisions { ...ProgramFileRevision }
}

fragment ProgramFileMeta on ProgramFileMeta {
    name
    lastModified
    size
    type
    directory
    syntax
    fileExists
    filePath
    data { ...ProgramFileMetaData }
}

fragment ProgramFile on ProgramFile {
    id
    instructionCount
    lineCount
    meta { ...ProgramFileMeta }
}

fragment ProgramExecutor on ProgramExecutor {
    id
    state
    instructionIndex
    instructionCount
    instructions(first: 50) {
        pageInfo { ...PageInfo }
        nodes { ...ProgramInstruction }
    }
    programFile {
        ...ProgramFile
    }
}

fragment ProgramFileDirectory on ProgramFileDirectory {
    path
    fileExtensions
    programFileMetas { ...ProgramFileMeta }
}

mutation SelectProgramFile($fileUpload: ClientFileUploadInput!) {
    programFileMeta: selectProgramFile(fileUpload: $fileUpload) { ...ProgramFileMeta }
}

mutation UploadProgramFile($fileUpload: ProgramFileUploadInput!) {
    programFile: uploadProgramFile(fileUpload: $fileUpload) { ...ProgramFile }
}

query ProgramDirectory {
    programFileDirectory: programDirectory { ...ProgramFileDirectory }
}

mutation LoadProgram($name: String!) {
    programFile: loadProgram(name: $name) { ...ProgramFile }
}

subscription MachineProgram($portName: String!) {
    machine: onMachineProgram(portName: $portName) {
        topicId
        program { ...ProgramExecutor }
    }
}
