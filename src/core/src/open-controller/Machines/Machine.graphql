fragment ControlledMachine on ControlledMachine {
    topicId
    machineProfileId
    firmwareRequirement {
        ...FirmwareRequirement
    }
    configuration {
        ...MachineConfig
    }
    status {
        ...MachineStatus
    }
    settings {
        ...MachineSetting
    }
}

fragment DetectedFirmware on MachineDetectedFirmware {
    friendlyName
    isValid
    name
    value
    edition
    protocol
    welcomeMessage
}

fragment MachineModals on MachineModals {
    units
}

fragment SpindleConfig on SpindleConfig {
    tool
    spinSpeed
    feedRate
    isFloodCoolantEnabled
    isMistCoolantEnabled
}

fragment MachineConfig on MachineConfiguration {
    firmware {
        ...DetectedFirmware
    }
    modals {
        ...MachineModals
    }
    spindle {
        ...SpindleConfig
    }
}

fragment MachineAlert on MachineAlert {
    code
    name
    message
}

fragment MachinePosition on MachinePosition {
    x
    y
    z
    e
    isValid
}

fragment MachineBuffer on MachineBuffer {
    lineNumber
    availableReceive
    availableSend
}

fragment SpindleState on MachineSpindle {
    direction
    isOn
    spinSpeed
    feedRate
    isFloodCoolantEnabled
    isMistCoolantEnabled
}

fragment MachineOverrides on MachineOverrides {
    feed
    rapids
    spindle
}

fragment MachineStatus on MachineStatus {
    activityState
    machinePosition {
        ...MachinePosition
    }
    workPosition {
        ...MachinePosition
    }
    workCoordinateOffset {
        ...MachinePosition
    }
    error {
        ...MachineAlert
    }
    alarm {
        ...MachineAlert
    }
    buffer {
        ...MachineBuffer
    }
    activePins
    spindle {
        ...SpindleState
    }
    overrides {
        ...MachineOverrides
    }
}

fragment MachineSetting on MachineSetting {
    id
    title
    settingType
    key
    value
}

subscription MachineConfiguration($portName: String!) {
    machine: onMachineConfiguration(portName: $portName) {
        topicId
        configuration {
            ...MachineConfig
        }
    }
}

subscription MachineStatus($portName: String!) {
    machine: onMachineStatus(portName: $portName) {
        topicId
        status {
            ...MachineStatus
        }
    }
}

subscription MachineSettings($portName: String!) {
    machine: onMachineSetting(portName: $portName) {
        topicId
        settings {
            ...MachineSetting
        }
    }
}
