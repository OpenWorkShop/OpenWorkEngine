fragment MachinePresetSettingProps on MachinePresetSetting {
  id
  title
  settingType
  key
  value
}

fragment FirmwareSettingPolymorphic on FirmwareSetting {
  id
  title
  key
  value
  units
  hasBeenRead
  currentValue {
    ...on ParsedDecimal {
      valueDecimal
    }
    ...on ParsedString {
      valueString
    }
    ...on ParsedAxisFlags {
      valueAxisFlags { x, y, z }
    }
    ...on ParsedBool {
      valueBool
    }
    ...on ParsedEnumOfKinematicsMode {
      valueKinematicsMode: valueEnum
    }
    ...on ParsedEnumOfStatusReportType {
      valueStatusReportType: valueEnum
    }
  }
}

fragment FirmwareSettingDecimal on FirmwareSettingOfDecimal {
  id
  title
  key
  data
}

fragment FirmwareSettingBool on FirmwareSettingOfBoolean {
  id
  title
  key
  data
}

fragment FirmwareSettingAxisFlags on FirmwareSettingOfAxisFlags {
  id
  title
  key
  data {
    x
    y
    z
  }
}

fragment FirmwareAxisValues on FirmwareAxisValues {
  x { ...FirmwareSettingDecimal }
  y { ...FirmwareSettingDecimal }
  z { ...FirmwareSettingDecimal }
}

fragment FirmwareApplicatorSettings on FirmwareApplicatorSettings {
  speedMax { ...FirmwareSettingDecimal }
  speedMin { ...FirmwareSettingDecimal }
  laserEnabled { ...FirmwareSettingBool }
  shuttleRadius { ...FirmwareSettingDecimal }
  shuttleWeight { ...FirmwareSettingDecimal }
  # Or just get all:
  settings { ...FirmwareSettingPolymorphic }
}

fragment FirmwareCalibrationSettings on FirmwareCalibrationSettings {
  kinematics {
    id
    title
    key
    data
  }
  motorDistance { ...FirmwareAxisValues }
  scaling { ...FirmwareAxisValues }
  chainLength { ...FirmwareSettingDecimal }
  chainOverSprocket { ...FirmwareSettingBool }
  chainSagCorrection { ...FirmwareSettingDecimal }
  chainElongationFactor { ...FirmwareSettingDecimal }
  leftChainTolerance { ...FirmwareSettingDecimal }
  rightChainTolerance { ...FirmwareSettingDecimal }
  homeChainLengths { ...FirmwareSettingDecimal }
  # Or just get all:
  settings { ...FirmwareSettingPolymorphic }
}

fragment FirmwareHomingSettings on FirmwareHomingSettings {
  enabled { ...FirmwareSettingBool }
  directionInvert { ...FirmwareSettingAxisFlags }
  feedRate { ...FirmwareSettingDecimal }
  seekRate { ...FirmwareSettingDecimal }
  debounce { ...FirmwareSettingDecimal }
  pullOff { ...FirmwareSettingDecimal }
  # Or just get all:
  settings { ...FirmwareSettingPolymorphic }
}

fragment FirmwareMovementSettings on FirmwareMovementSettings {
  junctionDeviation { ...FirmwareSettingDecimal }
  arcTolerance { ...FirmwareSettingDecimal }
  softLimits { ...FirmwareSettingBool }
  hardLimits { ...FirmwareSettingBool }
  rateMax { ...FirmwareAxisValues }
  acceleration { ...FirmwareAxisValues }
  positionMax { ...FirmwareAxisValues }
  positionMin { ...FirmwareAxisValues }
  machineSize { ...FirmwareAxisValues }
  # Or just get all:
  settings { ...FirmwareSettingPolymorphic }
}

fragment FirmwarePinsSettings on FirmwarePinsSettings {
  stepPulse { ...FirmwareSettingDecimal }
  stepIdleDelay { ...FirmwareSettingDecimal }
  stepSignalInvert { ...FirmwareSettingAxisFlags }
  stepDirectionInvert { ...FirmwareSettingAxisFlags }
  stepEnableInvert { ...FirmwareSettingBool }
  limitPinsInvert { ...FirmwareSettingBool }
  probePinInvert { ...FirmwareSettingBool }
  steps { ...FirmwareAxisValues }
  kProportional { ...FirmwareAxisValues }
  kDerivative { ...FirmwareAxisValues }
  kIntegral { ...FirmwareAxisValues }
  imax { ...FirmwareAxisValues }

  # Or just get all:
  settings { ...FirmwareSettingPolymorphic }
}

fragment FirmwareReportingSettings on FirmwareReportingSettings {
  statusReport {
    id
    title
    settingType
    key
    data
  }
  reportInches { ...FirmwareSettingBool }
  # Or just get all:
  settings { ...FirmwareSettingPolymorphic }
}

# TWO OPTIONS for FirmwareSettings

# 1) [List]: Polymorphic typed settings get everything in one list (requires unboxing polymorhism, good for iterating)
fragment FirmwareSettingsList on FirmwareSettings {
  settings {
    ...FirmwareSettingPolymorphic
  }
}

# 2) [Typed]: each object in the tree is strongly typed
fragment FirmwareSettingsTyped on FirmwareSettings {
  applicator { ...FirmwareApplicatorSettings }
  calibration { ...FirmwareCalibrationSettings }
  homing { ...FirmwareHomingSettings }
  movement { ...FirmwareMovementSettings }
  pins { ...FirmwarePinsSettings }
  reporting { ...FirmwareReportingSettings }
}

subscription MachineSettings($portName: String!) {
  machine: onMachineSetting(portName: $portName) {
    topicId
    settings { ...FirmwareSettingsTyped  }
  }
}
